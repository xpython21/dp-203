const { EventHubProducerClient } = require("@azure/event-hubs");
const faker = require("faker");

const connectionString = "EVENTHUBCONNECTIONSTRING";
const eventHubName = "EVENTHUBNAME";

// Generate a random employee name from a predefined list of fake names
function generateEmployeeName() {
  const fakeNames = [
    "John Doe",
    "Jane Smith",
    "Michael Johnson",
    "Emily Davis",
    "Daniel Wilson",
    "Olivia Brown"
  ];
  const randomIndex = Math.floor(Math.random() * fakeNames.length);
  return fakeNames[randomIndex];
}

async function main() {
  // Create a producer client to send messages to the event hub.
  const producer = new EventHubProducerClient(connectionString, eventHubName);

  const states = ["Maine", "New York", "Utah", "Nebraska", "Texas"];

  const storeIDs = [12, 15, 22, 32, 9, 5];

  var i;

  for (i = 0; i < 100; i++) {
    // Generate a random order
    var p = Math.floor(Math.random() * 10) + 1;
    var q = Math.floor(Math.random() * 3) + 1;
    var storeID = storeIDs[Math.floor(Math.random() * storeIDs.length)];
    var employeeName = generateEmployeeName();
    var state = states[Math.floor(Math.random() * states.length)];

    var batch = await producer.createBatch();
    batch.tryAdd({
      body: {
        ProductID: p,
        Quantity: q,
        StoreID: storeID,
        EmployeeName: employeeName,
        USState: state
      }
    });

    // Send the batch to the event hub.
    await producer.sendBatch(batch);

    console.log(
      "{ProductID:" +
        p +
        ", Quantity:" +
        q +
        ", StoreID:" +
        storeID +
        ", EmployeeName:" +
        employeeName +
        ", USState:" +
        state +
        "}"
    );
  }

  // Close the producer client.
  await producer.close();
}

main().catch((err) => {
  console.log("Error occurred: ", err);
});
